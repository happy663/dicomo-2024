
\section{ライブラリの検証と他環境における検討}
この章では提案したライブラリの有効性を検証する．
検証はxDR Challenge 2023での評価を基に行い，
また他環境でこれらのライブラリが適用可能かを検討する．

\subsection{xDR Challenge 2023環境での評価}


xDR Challenge 2023の環境についてあらためて詳細に説明する．
対象施設は高速道路のサービスエリアである．
対象の建物は2つあり，1つは2階建て，もう1つは平屋である．
提供される訓練データとスコアリングデータの詳細を表\ref{table:data}に示す．
BLEビーコンとしてMyBeacon(Aplix)\cite{beacon-aplix}を利用し，BLE信号は0.1秒ごとに発信される．
ビーコンの位置は，フロアマップの座標の (x, y, z) 位置として提供される．
競技に使用される9軸IMUセンサデータはAQUOS Sense 6（SHARP）により計測される．
正解のデータはハンドヘルド LiDAR (GeoSLAM ZEB-Horizon) を使用して約 100 Hz で測定される．
サンプリングデータは歩行時間が54秒から667秒までの全323個のデータが提供された．
スコアリングデータは歩行時間が134秒から234秒までの全9個データが提供された．
スコアリングはBLEビーコンのデータがないものとあるものでそれぞれ行われる．
9データのうち3個がBLEビーコンのデータが与えられず，残りの6個にはBLEビーコンのデータが与えられる．


\begin{table*}[ht]
	\centering
	\caption{提供データの概要}
	\scalebox{0.8}{
		\begin{tabular}{|l|l|l|l|l|}
			\hline
			データタイプ                        & 測定デバイス        & レート                                & 訓練データ & スコアリングデータ    \\ \hline
			加速度                           & AQUOS Sense 6 & 約100Hz                             & 使用可能  & 使用可能         \\ \hline
			角速度                           & AQUOS Sense 6 & 約100Hz                             & 使用可能  & 使用可能         \\ \hline
			磁気                            & AQUOS Sense 6 & 約100Hz                             & 使用可能  & 使用可能         \\ \hline
			BLE RSSI                      & AQUOS Sense 6 & 10Hzのビーコンから送信、AQUOS Sense 6で受信時に記録 & 使用可能  & 使用可能         \\ \hline
			正解位置 (Ground Truth) (x, y, z) & ZEB-Horizon   & 約100Hz                             & 使用可能  & 始めと終わりのみ使用可能 \\ \hline
			正解姿勢 (Ground Truth) (四元数)     & ZEB-Horizon   & 約100Hz                             & 使用可能  & 始めと終わりのみ使用可能 \\ \hline
			正解階層名 (Ground Truth)          & -             & 各パスの1階層名                           & 使用可能  & 使用可能         \\ \hline
		\end{tabular}
		ii		\label{table:data}
	}
\end{table*}

xDR Challenge 2023ではPDRベンチマーク標準化委員会によって
提供された評価フレームワークを使用して評価が行われた．
このフレームワークではl\_ce(CE:円形誤差)，l\_ca(CA\_l:局所空間における円形精度)，
l\_eag(誤差蓄積勾配)，l\_ve(VE:速度誤差)，l\_obstacle(障害物回避要件)
の5つの評価指標が用いられた．
総合評価指標は式\ref{eq:evaluation_index}に示す式で計算される．
このライブラリを使って得られた評価と各指標の重みを表\ref{table:evaluation_index}に示す．
l\_ce，l\_eag， l\_ve，l\_obstacleでは一定の精度を得られた．
しかしl\_caでは精度が低かった．
l\_caの値が低いと場合局所空間における位置推定誤差の分布が広い．
これは環境条件の変化やセンサデータの微妙な違いが，位置推定結果に大きな影響を与える可能性が高い．
この問題を解決するためには，PDRアルゴリズムを改善し，より精度の高い位置推定を行う必要がある．

\begin{equation}
	\begin{aligned}
		I_i = & W_{ce} \times I_{ce} + W_{ca} \times I_{ca}                                        \\
		      & + W_{eag} \times I_{eag} + W_{ve} \times I_{ve} + W_{obstacle} \times I_{obstacle}
	\end{aligned}
	\label{eq:evaluation_index}
\end{equation}


\begin{table}[ht]
	\caption{評価指数の概要}
	\centering
	\begin{tabular}{l|l|l}
		\hline
		指標                        & 値 (\%) & 重み   \\ \hline
		l\_ce（CE：円形誤差）            & 88.55  & 0.25 \\
		l\_ca（CA\_l：局所空間における円形精度） & 62.51  & 0.20 \\
		l\_eag（EAG：誤差蓄積勾配）        & 93.02  & 0.25 \\
		l\_ve（VE：速度誤差）            & 95.55  & 0.15 \\
		l\_obstacle（障害物回避要件）      & 93.48  & 0.15 \\
		l (総合評価指数)                & 86.25  &      \\ \hline
	\end{tabular}
	\label{table:evaluation_index}
\end{table}


\subsection{駅の構内での検討}
駅構内での位置推定をする場合を考える．
駅は多くの人々が日常的に使用する場所であり，駅を対象として位置推定の研究も行われるなど位置推定の需要が高い．
駅の改札は地上から続いてるものもあれば地下にあるものもある．
地下の場合は特に衛星からの電波が届きにくい場所であるためGPSが有効ではない．
このような環境ではPDRが有効な手法である．
駅の改札の位置は工事などがない限り，基本的に固定位置から変化しない．
改札を通った時の位置をPDRの正解初期座標として使用できる．
改札を通って出た後，乗り換えを行う場合がある．
このような場合は次の改札口を正解補正座標として利用できる．
ICなどを使って駅改札を通った場合，ユーザを一意に識別できる．
そのため特定のユーザが乗り換えをしたという情報を収集するのは比較的容易である．
正解初期地点と正解補正座標を利用すればListing\ref{lst:remove-drift}に示したドリフト補正を適用できる．
また全ての駅ではないがある一定規模以上の駅構内の場合フロアマップ情報が入手できる可能性が高い．
その場合フロアマップ情報を用いたListing\ref{lst:map-matching}のマップマッチング補正が適用できる．

\subsection{大学のキャンパスでの検討}
大学のキャンパスで位置推定をする場合を考える．
大学には屋外環境と屋内環境がある．
建物間の移動経路を把握する場合はGPSが有効である．
しかし大学の建物内での移動経路を把握する場合GPSでは困難である．
このような場合にPDRを軸とした移動経路の把握を検討できる．
大学は研究室やサ―クルなど異なるコミュニティが混在している．
それらは1つの組織が大本で管理しているのではなく個々が独立運営している．
このような場所でBLEビーコンを配置する場合，各コミュニティへの申請のコストや
，場合によっては配置を拒否される可能性がある．
BLEビ―コン以外の電波の利用を考えた場合，Wi-Fiの電波の利用が検討できる．
Wi-Fiの基地局なら基本的にどのコミュニティにも配置がしてあり，設置コストの面でBLEビーコンと比べると低い．
しかし既知のWi-Fiの基地局位置情報の把握はコストが大きい．
そのためこのような場所ではWi-Fiの電波を使ったFP補正が有効だと考えられる．
FPを使った手法なら基地局の位置情報を把握していない場合でも利用できる．
３章ではBLEビ―コンの元にFP処理を行う関数を実装した．
Wi-FiとBLEは通信範囲や消費電力などで異なる点はあり，
内部の処理や閾値を変化させる必要はあるが，基本的に与える引数やそのデ―タ形式を揃えれば同様に適用できる．
また部屋に出入りする際には固定の位置の出入り口がある．
個人がそこを出入りしたという情報を取得できれば，
正解初期座標や正解補正座標としてドリフト除去を適用できる．


